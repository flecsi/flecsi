

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Developer Guide &mdash; FleCSI 2.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  
    <link rel="canonical" href="https://flecsi.orgsrc/developer-guide.html"/>
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Internal Summary" href="summary.html" />
    <link rel="prev" title="Logging Utility" href="user-guide/flog.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/flecsi.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                Version: 2.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Build &amp; Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-guide.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Developer Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#style-guide">Style Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#exceptions">Exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#additional-rules">Additional Rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#directory-structure">Directory Structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#versioning">Versioning</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#branch-types">Branch Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tags">Tags</a></li>
<li class="toctree-l3"><a class="reference internal" href="#workflow">Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#branch-tag-creation">Branch &amp; Tag Creation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#container-images">Container Images</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installing-a-container-engine">Installing a Container Engine</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#docker">Docker</a></li>
<li class="toctree-l4"><a class="reference internal" href="#podman">Podman</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tutorial-image">Tutorial Image</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#building-and-testing-locally">Building and Testing Locally</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pushing-to-hub-docker-com">Pushing to hub.docker.com</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#gitlab-ci">Gitlab CI</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#build-system">Build System</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#spack-cheat-sheet">Spack Cheat Sheet</a></li>
<li class="toctree-l2"><a class="reference internal" href="#git-cheat-sheet">Git Cheat Sheet</a></li>
<li class="toctree-l2"><a class="reference internal" href="#graphviz-notes">Graphviz Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sphinx">Sphinx</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#links">Links</a></li>
<li class="toctree-l3"><a class="reference internal" href="#figures">Figures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#code-blocks">Code Blocks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#console">Console</a></li>
<li class="toctree-l4"><a class="reference internal" href="#c">C++</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#literal-includes">Literal Includes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="summary.html">Internal Summary</a></li>
<li class="toctree-l1"><a class="reference external" href="http://laristra.github.io/flecsi/doxygen">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="team.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="team.html#alumni">Alumni</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">FleCSI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Developer Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/src/developer-guide.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="developer-guide">
<h1>Developer Guide<a class="headerlink" href="#developer-guide" title="Permalink to this headline">¶</a></h1>
<p>This documentation is intended for developers of the core FleCSI
library.</p>
<hr class="docutils" />
<div class="section" id="style-guide">
<h2>Style Guide<a class="headerlink" href="#style-guide" title="Permalink to this headline">¶</a></h2>
<p>Unless otherwise specified, follow the <a class="reference external" href="https://www.boost.org/development/requirements.html#Design_and_Programming">Boost “Design and Programming”
guidelines</a> and <a class="reference external" href="https://www.boost.org/development/header.html">header guidelines</a>.  They do not address purely stylistic
matters of indentation, spacing, and brace placement; those are addressed for
FleCSI by <code class="docutils literal notranslate"><span class="pre">clang-format</span></code>.</p>
<div class="section" id="exceptions">
<h3>Exceptions<a class="headerlink" href="#exceptions" title="Permalink to this headline">¶</a></h3>
<p>Starting from the 2019 version:</p>
<ul class="simple">
<li><p>Optimization does matter for FleCSI, but only where the overhead it
introduces is expected to be a significant fraction of the application’s
runtime.</p></li>
<li><p>Obviously FleCSI uses certain additional libraries (like Legion).  Do not
add further dependencies without discussion.  As a single component, there
is no need to limit use of one part of FleCSI by another.</p></li>
<li><p>The ABI concerns, especially for Windows, are irrelevant.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">noexcept</span></code> has replaced exception-specifications and should be used as
appropriate, especially for move operations.</p></li>
<li><p>FleCSI uses its own unit-testing framework, not Boost’s.</p></li>
<li><p>The preferable line-length limit is 78 characters, so that even a diff of
such a file avoids the line continuations used in some displays.</p></li>
<li><p>Individual documentation files do not get their own copyright/license.</p></li>
<li><p>The source-file header is of course different.</p></li>
<li><p>FleCSI uses <code class="docutils literal notranslate"><span class="pre">flog_assert</span></code>, not <code class="docutils literal notranslate"><span class="pre">BOOST_ASSERT</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min</span></code> and <code class="docutils literal notranslate"><span class="pre">max</span></code> do not require special treatment.</p></li>
<li><p>Header and source files are suffixed with <code class="docutils literal notranslate"><span class="pre">.hh</span></code> and <code class="docutils literal notranslate"><span class="pre">.cc</span></code>.</p></li>
<li><p>There are no “primary directories”.</p></li>
<li><p>Code documentation is generated by Doxygen, prose by Sphinx.</p></li>
</ul>
</div>
<div class="section" id="additional-rules">
<h3>Additional Rules<a class="headerlink" href="#additional-rules" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Changes purely for stylistic reasons should be rare and must appear in a
separate commit (preferably a separate merge request).</p></li>
<li><p>Class and enumeration names do not get a suffix <code class="docutils literal notranslate"><span class="pre">_t</span></code>.</p></li>
<li><p>Header names are “absolute” (<em>i.e.</em>, begin with <code class="docutils literal notranslate"><span class="pre">flecsi/</span></code>).</p></li>
<li><p>Function documentation uses the imperative mood.</p></li>
</ul>
</div>
<div class="section" id="directory-structure">
<h3>Directory Structure<a class="headerlink" href="#directory-structure" title="Permalink to this headline">¶</a></h3>
<p>The source code for the core FleCSI infrastructure is located in the
<em>top-level/flecsi</em> directory. For the most part, the subdirectories of
this directory correspond to the different namespaces in the core
infrastructure. Each of these subdirectories must contain a valid
CMakeLists.txt file. However, none of their children should have a
CMakeLists.txt file, i.e., the build system will not recurse beyond the
first level of subdirectories. Developers should use relative paths
within a CMakeLists.txt file to identify source in subdirectories.</p>
<p>Unit test files should be placed in the <em>test</em> subdirectory of each
namespace subdirectory. By convention, developers should not create
subdirectories within the test subdirectory.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="versioning">
<h2>Versioning<a class="headerlink" href="#versioning" title="Permalink to this headline">¶</a></h2>
<p>FleCSI’s versioning system uses three branch types (descibed below) that
define the purpose and provenance of the code at a particular commit,
with tags that label points of interest in the development cycle, e.g,.
releases or stable features.</p>
<div class="section" id="branch-types">
<h3>Branch Types<a class="headerlink" href="#branch-types" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>incompatible</strong> <br />
The <em>devel</em> branch is where work on the next major release takes
place, potentially with interface and feature changes that are
<em>incompatible</em> with previous versions.</p></li>
<li><p><strong>feature</strong> <br />
Feature branches (named for their <em>major</em> version number, e.g., 1, 2,
3) are for feature development on the current major version.</p></li>
<li><p><strong>release</strong> <br />
Release branches (named for their <em>major.minor</em> version number, e.g.,
1.1, 1.2) are stable versions of the code base. These can only be
modified with bug fixes. At appropriate points, tags (named for their
<em>major.minor.patch</em> version number, e.g., 1.1.2) are used to identify
patched versions.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>At the time of writing, FleCSI has the following branches:</p>
<p><strong>devel</strong> (incompatible) <br />
<strong>1</strong> (feature) <br />
<strong>1.4</strong> (release)</p>
</div>
</div>
<div class="section" id="tags">
<h3>Tags<a class="headerlink" href="#tags" title="Permalink to this headline">¶</a></h3>
<p>The form of a tag is determined by the underlying branch type and commit
it is intended to reference:</p>
<ul class="simple">
<li><p><strong>devel branch</strong> <br />
In general, a commit on the devel branch should only be tagged if it
is the first commit <em>after</em> a new feature branch has been created, or
if a <em>down-stream</em> branch has been merged into it. The tag should be
named with <em>d</em> and the major version of the feature branch, and the
number of down-stream merges, e.g., when feature branch <em>2</em> is created,
a new devel tag <em>d2.0</em> should be created on the next devel commit.
Everytime down-stream commits are merged, the second digit should be
incremented, e.g., <em>d2.0</em> -&gt; <em>d2.1</em>.</p></li>
<li><p><strong>feature branch</strong> <br />
Feature tags should be created on the next commit after a new release
branch is created, with <em>f</em> and the major.minor version of the release
branch, e.g., when release branch <em>1.5</em> is created, a new feature tag
<em>f1.5.0</em> should be created on the next feature commit, where the third
digit is the number of down-stream merges (0 in this case). Feature
tags should also be created whenever down-stream commits are merged,
e.g., <em>f1.5.0</em> -&gt; <em>f1.5.1</em>.</p></li>
<li><p><strong>release branch</strong> <br />
Release tags should be created for each new release, with <em>v</em> and the
release version, e.g., <em>v1.4.1</em>.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Tags mark a <em>whence</em> or <em>origin</em> for development rather than a
<em>whither</em> or <em>completion</em>. The first letter of the tag is important,
i.e., <em>d</em>, <em>f</em>, or <em>v</em>, as it is used by FleCSI to determine the
branch type of the tag during CMake configuration.</p>
<ul class="simple">
<li><p>devel tags are of the form: <em>d</em> + <em>whence.merge</em>, e.g., <em>d2.4</em></p></li>
<li><p>feature tags are of the form: <em>f</em> + <em>major.minor.merge</em>, e.g.,
<em>f3.0.2</em></p></li>
<li><p>version tags are of the form: <em>v</em> + <em>major.minor.patch</em>, e.g.,
<em>v3.1.10</em></p></li>
</ul>
</div>
</div>
<div class="section" id="workflow">
<h3>Workflow<a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h3>
<p>FleCSI development uses a <em>devel -&gt; feature -&gt; release</em> forking workflow
that can be visualized as in <a class="reference internal" href="#branch"><span class="std std-numref">Fig. 10</span></a>. Bugfixes and features can
be back-merged into <em>feature</em> or <em>devel</em>, as appropriate.</p>
<div class="figure align-default" id="id15">
<span id="branch"></span><img alt="../_images/branch.png" src="../_images/branch.png" />
<p class="caption"><span class="caption-number">Fig. 10 </span><span class="caption-text">Workflow diagram illustrating basic workflow using the three branch
types described above. (Figure due to Angela Herring.)</span><a class="headerlink" href="#id15" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="branch-tag-creation">
<h3>Branch &amp; Tag Creation<a class="headerlink" href="#branch-tag-creation" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Only project maintainers are allowed to create new branches and tags.</p>
</div>
<p>Creating a FleCSI release, or feature means creating a new branch and
potentially tagging it at a particular commit. The process for doing
this is described in the following steps.</p>
<ol class="arabic simple">
<li><p>Create a local branch from the appropriate <em>upstream</em> commit.
This will either be from <em>devel</em> (feature, or release), or an
existing feature branch (release only). It is important to follow
the correct naming conventions for the branch, e.g., the branch name
will be the <em>major</em> revision number for a <strong>feature</strong> branch, and the
<em>major.minor</em> revision number for a <strong>realease</strong> branch. If the
branch you need already exists, you will only need to create a new
tag, and you can skip this step.</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git checkout COMMIT_HASH -b BRANCH_NAME
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>To create the new feature branch from the current commit on the
<em>devel</em> branch, where devel is tagged at <em>d2.x</em>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git checkout origin/devel -b <span class="m">3</span>
<span class="gp">$</span> git push origin
</pre></div>
</div>
</div>
<ol class="arabic simple" start="2">
<li><p>Update the <em>.version</em> file with the correct version string:</p>
<ul class="simple">
<li><p>devel: <em>d</em> followed by <em>whence.merge</em>, e.g., <em>d1.0-0-0</em></p></li>
<li><p>feature: <em>f</em> followed by <em>whither.minor.merge</em>, e.g., <em>f2.0.1-0-0</em></p></li>
<li><p>release: <em>v</em> followed by <em>major.minor.patch</em>, e.g., <em>f2.1.3-0-0</em></p></li>
</ul>
</li>
</ol>
<blockquote>
<div><p>The <cite>0-0</cite> on the end of each version is there to mimic the output of
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">describe</span></code>. The <em>.version</em> file itself is only used by FleCSI if
the source tree is not a git repository, e.g., if the source was
obtained by the user as an archive.</p>
</div></blockquote>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Version information for <em>devel</em> and <em>feature</em> branches differ, in
that devel branches indicate <em>whence</em> the branch originated, e.g.,
development for version <em>3.0</em> would originate with interface
compatibility with major version <em>2</em>, so the devel branch would be
tagged <em>d2.x</em>, where <em>x</em> is the number of down-stream merges that have
been applied, and feature branches indicate <em>whither</em> the branch is
targeted, e.g., feature updates on <em>2</em> that will be part of a <em>2.x</em>
release would be named <em>f2.x.y</em>, where <em>x</em> is the <em>minor</em> version,
and <em>y</em> is the number of down-stream merges that have been applied.</p>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>To update the <em>.version</em> file for a new down-stream merge to devel at
<em>d2.2</em>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cat <span class="s2">&quot;d2.3-0-0&quot;</span> &gt; .version
</pre></div>
</div>
<p>This increments the down-stream merge count by one.</p>
</div>
<ol class="arabic simple" start="3">
<li><p>Create the appropriate annotated tag from your commit:</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git tag -a -m <span class="s2">&quot;FleCSI Major.Minor (Development, or Feature, or Release)&quot;</span> tagname <span class="sb">`</span>git rev-list -n <span class="m">1</span> HEAD<span class="sb">`</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Push your tag to gitlab:</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git push --tags gitlab.lanl.gov:flecsi/flecsi.git
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>Push your commit and create a merge request for the version-update commit.</p></li>
</ol>
</div>
</div>
<hr class="docutils" />
<div class="section" id="container-images">
<h2>Container Images<a class="headerlink" href="#container-images" title="Permalink to this headline">¶</a></h2>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>These sections assumes that you are familiar with container management
using a container engine like <em>Docker</em>. If you are not, there is
excellent documentation starting <a class="reference external" href="https://docs.docker.com/get-started">here</a>. Additionally, we include
instructions and links for installation and basic usage below.</p>
</div>
<div class="section" id="installing-a-container-engine">
<h3>Installing a Container Engine<a class="headerlink" href="#installing-a-container-engine" title="Permalink to this headline">¶</a></h3>
<p>This section provides links to installation and usage documentation for
<em>Docker</em>, and <em>Podman</em>.</p>
<div class="section" id="docker">
<h4>Docker<a class="headerlink" href="#docker" title="Permalink to this headline">¶</a></h4>
<p>The Docker daemon is available for a variety of platforms from the
<a class="reference external" href="https://www.docker.com">docker</a> website.</p>
<p>For linux, the community engine is available for several distributions:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.docker.com/install/linux/docker-ce/fedora">Fedora</a></p></li>
<li><p><a class="reference external" href="https://docs.docker.com/install/linux/docker-ce/ubuntu">Ubuntu</a></p></li>
<li><p><a class="reference external" href="https://docs.docker.com/install/linux/docker-ce/centos">CentOS</a></p></li>
</ul>
</div>
<div class="section" id="podman">
<h4>Podman<a class="headerlink" href="#podman" title="Permalink to this headline">¶</a></h4>
<p>An alternative, drop-in replacement for Docker is <a class="reference external" href="https://podman.io">Podman</a>. Podman has
the advantage that it is daemonless, and does not require root
privileges to run (mostly).</p>
<ul class="simple">
<li><p><a class="reference external" href="https://podman.io/getting-started/installation">Install Podman</a></p></li>
</ul>
</div>
</div>
<div class="section" id="tutorial-image">
<h3>Tutorial Image<a class="headerlink" href="#tutorial-image" title="Permalink to this headline">¶</a></h3>
<p>This section details the steps to modify and update the docker image for
the FleCSI tutorials.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>These instructions are only relevant if you want to modify or
rename the automatically generated tutorial images. The docker files in
this directory are automatically built on Docker Hub, whenever they get
modified on GitHub.  These instructions are primarily intended for
developers who are modifying the image scripts and need to test them.</p>
</div>
<div class="section" id="building-and-testing-locally">
<h4>Building and Testing Locally<a class="headerlink" href="#building-and-testing-locally" title="Permalink to this headline">¶</a></h4>
<p>The tutorial docker files are located in <em>flecsi/tutorial/docker</em>. These
instructions assume that you are in that directory.</p>
<p>To build a new docker image, you can execute the following:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> docker build -t laristra/flecsi-tutorial:TAG -f RUNTIME .
</pre></div>
</div>
<p>where <em>TAG</em> and <em>RUNTIME</em> are replaced with a tag and a specific runtime
backend, e.g., legion or mpi. The <em>TAG</em> argument may be any name that
you would like to give the image. The default is <em>latest</em>.</p>
<p>Docker will try to cache build steps and information that it doesn’t
think has changed. Sometimes it is useful to force docker to rebuild
everything from scratch. To do this, you can pass the <em>–no-cache</em> flag:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> docker build --no-cache -t laristra/flecsi-tutorial:TAG -f RUNTIME .
</pre></div>
</div>
<p>This is particularly useful if a repository has changed.</p>
<p>The default repository and branch for the container are
<em>https://gitlab.lanl.gov/laristra/flecsi.git</em> and <em>devel</em>, respectively.
If you are in the process of updating the container, and would like to
use a different repository and branch, you can specifiy them like:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> docker build --build-arg <span class="nv">REPO</span><span class="o">=</span>https://github.com/tuxfan/flecsi.git <span class="se">\</span>
  --build-arg <span class="nv">BRANCH</span><span class="o">=</span>tutorial-update --no-cache <span class="se">\</span>
  -t laristra/flecsi-tutorial:TAG -f RUNTIME .
</pre></div>
</div>
<p>where <em>REPO</em> is the git repo to use, and <em>BRANCH</em> is the branch name to
use.</p>
<p>Once you have successfully built the imager, you can test it using the
<em>run</em> command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>docker run -it --shm-size<span class="o">=</span>512m -u flecsi laristra/flecsi-tutorial:TAG /bin/bash
</pre></div>
</div>
<p>This will open an interactive shell (/bin/bash) on the running image.</p>
</div>
<div class="section" id="pushing-to-hub-docker-com">
<h4>Pushing to hub.docker.com<a class="headerlink" href="#pushing-to-hub-docker-com" title="Permalink to this headline">¶</a></h4>
<p>If you want to push images to the docker hub repository, you will need
to log in:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> docker login
</pre></div>
</div>
<p>This will prompt you for a username and password. You will need to be a
member of the <em>laristra</em> organization to successfully push images to the
docker hub. Once you are logged in, you can push an image to Docker Hub
with:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> docker push laristra/flecsi-tutorial:TAG
</pre></div>
</div>
<p>where TAG is the tag that you specified during the build.</p>
<p>In general, pushing the image manually is unnecessary because it will
automatically be rebuilt when the docker file is updated on GitHub.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="gitlab-ci">
<h3>Gitlab CI<a class="headerlink" href="#gitlab-ci" title="Permalink to this headline">¶</a></h3>
<p>FleCSI has a special branch <em>gitlab-ci</em> that provides images and
configuration files that are used for Gitlab’s continuous integration
(CI) services. The current set of utilties include:</p>
<ul>
<li><p><strong>Images</strong> <br />
Operating system, build environment, and FleCSI images. These use
dockerfile syntax, and can be built and run with docker, and podman
engines, or potentially, with any engine that is compatible with
docker-generated images.</p>
<p>The images are modular, and are intended to be used to build up
capabilities:</p>
<ul>
<li><p><strong>OS Images</strong> <br />
Located in the <em>os</em> directory, these are designed to provide a
standard base of functionality, i.e., a standard set of system
packages, which can be used interchangeably with down-stream
environment images.</p></li>
<li><p><strong>Environment</strong> <br />
Located in a directory named for the corresponding branch, e.g., the
environment dockerfile file for <em>devel</em> is located in the <em>devel</em>
directory, these are designed to provide a standard spack
environment for building FleCSI.</p>
<p>It is intended that developers add new directories when necessary to
support custom configuration of a branch that they are testing.</p>
</li>
<li><p><strong>Build</strong> <br />
Also located in the <em>branch</em> directory, the build image provides a
pre-built FleCSI installation that can be used for debugging, or as
a building block for other projects.</p></li>
</ul>
</li>
<li><p><strong>Spack Configuration Files</strong> <br />
Located in the <em>spack</em> subdirectory of an environment directory, these
allow customization of the spack install for a particular environment.
In particular, the <em>spack/packages.py</em> file should specify explicit
versions for as many packages as is feasible. Package versions should
only be elevated when necessary for new feature support. Following
this guideline will greatly increase stability.</p></li>
</ul>
<div class="section" id="build-system">
<h4>Build System<a class="headerlink" href="#build-system" title="Permalink to this headline">¶</a></h4>
<p>The <em>gitlab-ci</em> branch uses a standard CMake build system. There are
several important configuration options that you need to be aware of:</p>
<ul class="simple">
<li><p><strong>CI_BRANCH</strong> <br />
This is the branch name of the branch or fork of <em>gitlab-ci</em> that you
wish to use. The default is <em>gitlab-ci</em>. However, it is useful to be
able to set this to a personal branch name, so that you can test local
changes without doing a merge request to the central FleCSI Gitlab
project. Use this in conjunction with the <em>REPOSITORY</em> option.</p></li>
<li><p><strong>REPOSITORY</strong> <br />
This is the url for the repository where the build system will look
for the <em>CI_BRANCH</em> option that you specified. The default is the main
FleCSI Gitlab repository
<em>https://gitlab.lanl.gov/laristra/flecsi.git</em>. However, it is useful
to set this to your personal fork for testing new images.</p></li>
<li><p><strong>REGISTRY</strong> <br />
This is the container registry that will be used for <em>push-</em>, and
<em>pull-</em> targets. In general, this needs to be set to the registry that
is being used by the CI to pull images, e.g., laristra/flecsi-ci (this
is on dockerhub.com), or gitlab.lanl.gov:5050/laristra/flecsi
(internal container registry).</p></li>
<li><p><strong>CONTAINER_ENGINE</strong> <br />
This should be the name of the container engine that is installed on
your system. Currently, only <em>docker</em>, and <em>podman</em> are supported.
Additional engines may be added in the future.</p></li>
</ul>
<p>As an example configuration, consider the following:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> mkdir build
<span class="gp">$</span> <span class="nb">cd</span> build
<span class="gp">$</span> cmake .. -DCI_BRANCH<span class="o">=</span>ci-environment -DREPOSITORY<span class="o">=</span>https://github.com/tuxfan/flecsi.git -DREGISTRY<span class="o">=</span>gitlab.lanl.gov:5050/laristra/flecsi -DENGINE<span class="o">=</span>podman
</pre></div>
</div>
<p>This configuration will use the author’s <em>ci-environment</em> branch on
Github with the <em>podman</em> engine.</p>
<p>To build an image, try:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> make centos-8
</pre></div>
</div>
<p>This will build the <em>OS</em> image defined in <em>os/centos-8</em>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>A note of caution on building the images under the <em>gitlab-ci</em> branch.
Simply typing <em>make</em> after configuration will attempt to build <strong>all
of the images in the project!</strong> This can take several hours to complete!
If this is not your intention, you can list the build targets by
typing <code class="code docutils literal notranslate"><span class="pre">make</span> <span class="pre">help</span></code>. To build only a specific target, type
<code class="code docutils literal notranslate"><span class="pre">make</span> <span class="pre">TARGET</span></code>, where <em>TARGET</em> is the target that you would like
to build. Note also that building targets with dependencies will build
all of the dependencies of the target (This is unaviodable.)</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The build system also supports passing runtime options to the
container engine. These are of the form <em>STAGE</em>_EXTRA, e.g.,
BUILD_EXTRA, PUSH_EXTRA, and CLEAN_EXTRA. For example, BUILD_EXTRA can
be used to force complete rebuild of an image like:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> make <span class="nv">BUILD_EXTRA</span><span class="o">=</span><span class="s2">&quot;--pull --no-cache&quot;</span> centos-8
</pre></div>
</div>
<p>This will force the engine to start from scratch, i.e., pulling the
base image from the registry, and ignoring cached stages.</p>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="spack-cheat-sheet">
<h2>Spack Cheat Sheet<a class="headerlink" href="#spack-cheat-sheet" title="Permalink to this headline">¶</a></h2>
<p>To remove all cached sources:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> spack clean -d
</pre></div>
</div>
<p>To remove cached sources for a particular spec:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> spack clean -d spec
</pre></div>
</div>
<p>To uninstall all spack packages:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> spack uninstall -fay
</pre></div>
</div>
<p>To keep temporary staging files in /tmp/<em>$USER</em>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> spack install --keep-stage ...
</pre></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="git-cheat-sheet">
<h2>Git Cheat Sheet<a class="headerlink" href="#git-cheat-sheet" title="Permalink to this headline">¶</a></h2>
<p>To list remote tags, where <em>origin</em> is the remote name:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git ls-remote --tags origin
</pre></div>
</div>
<p>To lookup the hash referenced by a tag:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git rev-list -n <span class="m">1</span> <span class="nv">$TAG</span>
</pre></div>
</div>
<p>To get the message for an annotated tag:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git tag -nX <span class="o">(</span>X specifies lines of annotation<span class="o">)</span>
</pre></div>
</div>
<p>To sync tags:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git fetch --prune --prune-tags
</pre></div>
</div>
<p>To prune local tags that are not on the remote:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git tag -l <span class="p">|</span> xargs git tag -d <span class="o">&amp;&amp;</span> git fetch -t
</pre></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="graphviz-notes">
<h2>Graphviz Notes<a class="headerlink" href="#graphviz-notes" title="Permalink to this headline">¶</a></h2>
<p>FleCSI uses the <a class="reference external" href="https://graphviz.gitlab.io/_pages/pdf/libguide.pdf">libcgraph</a> interface to <a class="reference external" href="https://www.graphviz.org">Graphviz</a> to create
control model visualizations. The <em>libcgraph</em> interface is fairly
counterintuitive. One particular gotcha is that graph, node, and edge
attributes can only be set on attributes that have been defined for the
graph. If an attribute type has not been defined, the graph will ignore
it. There is not easy to remedy to this problem: attributes that are
added after initialization will reset all previously added elements to
whatever the default of the new attribute is. Therefore, if you need to
add an attribute, the best thing to do is to look at the <em>graphviz.hh</em>
file in ‘flecsi/utils’, and add it there with a reasonable default.</p>
</div>
<hr class="docutils" />
<div class="section" id="sphinx">
<h2>Sphinx<a class="headerlink" href="#sphinx" title="Permalink to this headline">¶</a></h2>
<p>Sphinx documentation is <a class="reference external" href="https://www.sphinx-doc.org/en/master">here</a>.
The following are some examples of frequently-used elements.
However, a good practice is to just look at the existing documentation
to figure out how something was done.</p>
<div class="section" id="links">
<h3>Links<a class="headerlink" href="#links" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>For more information look at `sphinx`__.

__ https://www.sphinx-doc.org/en/master/usage/restructuredtext/index.html
</pre></div>
</div>
<p>This will be rendered like:</p>
<p>For more information look at <a class="reference external" href="https://www.sphinx-doc.org/en/master/usage/restructuredtext/index.html">sphinx</a>.</p>
</div>
<div class="section" id="figures">
<h3>Figures<a class="headerlink" href="#figures" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">_undersea</span><span class="p">:</span>
<span class="o">..</span> <span class="n">figure</span><span class="p">::</span> <span class="n">images</span><span class="o">/</span><span class="n">undersea</span><span class="o">.</span><span class="n">png</span>
  <span class="p">:</span><span class="n">align</span><span class="p">:</span> <span class="n">center</span>
  <span class="p">:</span><span class="n">width</span><span class="p">:</span> <span class="mi">70</span><span class="o">%</span>

  <span class="n">A</span> <span class="n">colorful</span> <span class="n">image</span> <span class="n">resembling</span> <span class="n">a</span> <span class="n">cosmic</span> <span class="n">version</span> <span class="n">of</span> <span class="n">an</span> <span class="n">undersea</span> <span class="n">world</span><span class="o">.</span>
</pre></div>
</div>
<p>This will be rendered like:</p>
<div class="figure align-center" id="id16">
<span id="undersea"></span><a class="reference internal image-reference" href="../_images/undersea.png"><img alt="../_images/undersea.png" src="../_images/undersea.png" style="width: 70%;" /></a>
<p class="caption"><span class="caption-number">Fig. 11 </span><span class="caption-text">A colorful image resembling a cosmic version of an undersea world.</span><a class="headerlink" href="#id16" title="Permalink to this image">¶</a></p>
</div>
<p>You can reference the figure using its label <em>undersea</em> like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>As can be seen in :numref:`undersea`...
</pre></div>
</div>
<p>This will be rendered like:</p>
<p>As can be seen in <a class="reference internal" href="#undersea"><span class="std std-numref">Fig. 11</span></a>…</p>
</div>
<div class="section" id="code-blocks">
<h3>Code Blocks<a class="headerlink" href="#code-blocks" title="Permalink to this headline">¶</a></h3>
<p>Syntax highlighting for codes blocks uses <a class="reference external" href="https://pygments.org">pygments</a>, which supports
many programming and markup languages.</p>
<p>Here are two examples:</p>
<div class="section" id="console">
<h4>Console<a class="headerlink" href="#console" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.. code-block:: console

  $ xterm -hold -fs 10 -bg black -fg white -geometry 128x40 -e curl wttr.in
</pre></div>
</div>
<p>This will be rendered like:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> xterm -hold -fs <span class="m">10</span> -bg black -fg white -geometry 128x40 -e curl wttr.in
</pre></div>
</div>
</div>
<div class="section" id="c">
<h4>C++<a class="headerlink" href="#c" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">code</span><span class="o">-</span><span class="n">block</span><span class="p">::</span> <span class="n">cpp</span>

  <span class="n">template</span><span class="o">&lt;</span><span class="n">typename</span> <span class="n">Bar</span><span class="o">&gt;</span>
  <span class="n">using</span> <span class="n">Baz</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">&lt;</span><span class="n">Bar</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p>This will be rendered like:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Bar</span><span class="o">&gt;</span>
<span class="k">using</span> <span class="n">Baz</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">&lt;</span><span class="n">Bar</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="literal-includes">
<h3>Literal Includes<a class="headerlink" href="#literal-includes" title="Permalink to this headline">¶</a></h3>
<p>Literal includes allow you to directly include source code or other
inputs from the actual file you are referencing. This is useful because
any changes to the file will automatically be captured in the
documentation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">literalinclude</span><span class="p">::</span> <span class="o">../../../</span><span class="n">tutorial</span><span class="o">/</span><span class="n">standalone</span><span class="o">/</span><span class="n">standalone</span><span class="o">.</span><span class="n">cc</span>
  <span class="p">:</span><span class="n">language</span><span class="p">:</span> <span class="n">cpp</span>
  <span class="p">:</span><span class="n">lines</span><span class="p">:</span> <span class="mi">23</span><span class="o">-</span><span class="mi">45</span>
</pre></div>
</div>
<p>This will be rendered like:</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="summary.html" class="btn btn-neutral float-right" title="Internal Summary" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="user-guide/flog.html" class="btn btn-neutral float-left" title="Logging Utility" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright Copyright (c) 2016, Triad National Security, LLC

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    

  <style>
    /* Contents caption */
    .wy-menu-vertical>p.caption {
      color: #ffffff;
    }

    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #e3e2db;
    }
    .wy-side-nav-search>div.version, .wy-nav-top>div.version {
      color: #5f5d5f;
    }

    /* Sidebar */
    .wy-nav-side {
      background: #216897;
      color: #ffffff;
    }
  </style>


</body>
</html>