

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Topologies &mdash; FleCSI 2.2.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  
    <link rel="canonical" href="http://www.flecsi.org/src/user-guide/topologies.html"/>
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Runtime Model" href="runtime.html" />
    <link rel="prev" title="CMake for FleCSI client applications" href="cmake.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/flecsi.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                Version: 2.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build.html">Build &amp; Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer-guide.html">Developer Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../user-guide.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="cmake.html">CMake for FleCSI client applications</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Topologies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#index-spaces">Index Spaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basic-categories">Basic Categories</a></li>
<li class="toctree-l3"><a class="reference internal" href="#field-registration">Field Registration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#colorings">Colorings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="runtime.html">Runtime Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance.html">Performance Do’s and Don’ts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../team.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../team.html#alumni">Alumni</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">FleCSI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../user-guide.html">User Guide</a> &raquo;</li>
        
      <li>Topologies</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/src/user-guide/topologies.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="topologies">
<h1>Topologies<a class="headerlink" href="#topologies" title="Permalink to this headline">¶</a></h1>
<p>A <em>topology</em> is a distributed-memory object that stores user-registered fields on one or more <em>index spaces</em>.
It may also store structural information used to interpret those fields in terms appropriate to the <em>category</em> of topology (<em>e.g.</em>, an unstructured mesh).
Any number of instances may be created of any topology.</p>
<div class="section" id="index-spaces">
<h2>Index Spaces<a class="headerlink" href="#index-spaces" title="Permalink to this headline">¶</a></h2>
<p>In FleCSI, index spaces are used to define field arrays that represent
the user’s data. In simple terms, you can think of an index space as
just an enumeration of an array, with the added notion that an index
space represents a logical space of such arrays.</p>
<div class="admonition-definition admonition">
<p class="admonition-title">Definition</p>
<p>An index space is the space of possible enumerations of a logical set
of points or indices.</p>
</div>
<p>As an example, consider the cells of a mesh. These represent a set that
can be enumerated to define an index space. If a particular mesh
instance has 100 cells, these cells define a vector (or index set) in
the index space of cells. <em>We often still refer to this as an index
space or index space instance.</em> The vertices and edges of the mesh also
define index spaces. In fact, in FleCSI, index spaces are used to
represent the logical elements or entities of all of our topology types.</p>
<p>There are several benefits of index spaces. One is that they can be
iterated upon or over.  As an example, consider a simple <em>for</em> loop:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">i</span><span class="p">:</span> <span class="n">mesh</span><span class="p">.</span><span class="n">cells</span><span class="p">())</span> <span class="p">{</span>

  <span class="c1">// Do something work on the ith</span>
  <span class="c1">// index of the cells index space.</span>

<span class="p">}</span> <span class="c1">// for</span>
</pre></div>
</div>
<p>This example is just the C++ version of what was stated above about the
cells of a mesh defining an index space. However, as we will see in the
following sections, index spaces also improve our ability to reason about
parallelism, and free us from many of the computer science details that
obfuscate our algorithms.</p>
</div>
<div class="section" id="basic-categories">
<h2>Basic Categories<a class="headerlink" href="#basic-categories" title="Permalink to this headline">¶</a></h2>
<p>The most basic topology provided by FleCSI is called the <em>global</em>
topology.
It has a single implicit index space which is not partitioned; its field values can be written by a single task or read by every task in a parallel launch.</p>
<p>The next most basic topology type provided by FleCSI is the <em>index</em>
topology. Like the global topology, it has a single implicit index
space, which you can think of as the <em>indices</em>. The index topology also
has a runtime-specified size that describes how many indices there
should be.</p>
</div>
<div class="section" id="field-registration">
<h2>Field Registration<a class="headerlink" href="#field-registration" title="Permalink to this headline">¶</a></h2>
<p>Let’s look at an example of how to register fields against
the global and index topologies:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">flecsi</span><span class="p">;</span>

<span class="k">using</span> <span class="n">double_field</span> <span class="o">=</span> <span class="n">field</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="n">data</span><span class="o">::</span><span class="n">single</span><span class="o">&gt;</span><span class="p">;</span>

<span class="k">namespace</span> <span class="n">solver</span> <span class="p">{</span>
  <span class="k">const</span> <span class="n">double_field</span><span class="o">::</span><span class="n">definition</span><span class="o">&lt;</span><span class="n">topo</span><span class="o">::</span><span class="n">global</span><span class="o">&gt;</span> <span class="n">tolerance</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">namespace</span> <span class="n">hydro</span> <span class="p">{</span>
  <span class="k">const</span> <span class="n">double_field</span><span class="o">::</span><span class="n">definition</span><span class="o">&lt;</span><span class="n">topo</span><span class="o">::</span><span class="n">index</span><span class="o">&gt;</span> <span class="n">index_data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The first variable declaration in this example registers a field called <code class="docutils literal notranslate"><span class="pre">solver::tolerance</span></code> with type <code class="docutils literal notranslate"><span class="pre">double</span></code>.
The second registers two fields called <code class="docutils literal notranslate"><span class="pre">hydro::index_data</span></code> with type <code class="docutils literal notranslate"><span class="pre">double</span></code>.
(An array of fields can be used for data that logically have multiple states, as in a multi-step time evolution method.)</p>
<p>In both cases, the user does not need to explicitly specify index space.
As we will see, this is necessary for more complex
topology types that can be customized by a <em>specialization</em>.</p>
<p>Logically, registering a field against a topology type adds that field
to the type itself. This may not be intuitive to everyone, so let’s
consider what this means. When we create a C++ type, e.g., a class or
struct, we add data members to it in the definition of the type:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">field_data_t</span> <span class="p">{</span>
  <span class="kt">double</span> <span class="n">field_a</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">field_b</span><span class="p">;</span>
<span class="p">};</span> <span class="c1">// struct topology_t</span>
</pre></div>
</div>
<p>This is done manually at the time the type is written. With FleCSI,
registering fields against a FleCSI topology type is a kind of
customization that is logically equivalent to our <em>field_data_t</em> example
type. So, for instance, if we want fields <em>field_a</em>, and <em>field_b</em> to be
defined for the FleCSI index topology, we would register them like so:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">radiation</span> <span class="p">{</span>
  <span class="k">const</span> <span class="n">field</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="n">data</span><span class="o">::</span><span class="n">single</span><span class="o">&gt;::</span><span class="n">definition</span><span class="o">&lt;</span><span class="n">topo</span><span class="o">::</span><span class="n">index</span><span class="o">&gt;</span> <span class="n">field_a</span><span class="p">;</span>
  <span class="k">const</span> <span class="n">field</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">data</span><span class="o">::</span><span class="n">single</span><span class="o">&gt;::</span><span class="n">definition</span><span class="o">&lt;</span><span class="n">topo</span><span class="o">::</span><span class="n">index</span><span class="o">&gt;</span> <span class="n">field_b</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Optionally, we could also just register the field_data_t struct:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">radiation</span> <span class="p">{</span>
  <span class="k">const</span> <span class="n">field</span><span class="o">&lt;</span><span class="n">field_data_t</span><span class="p">,</span> <span class="n">data</span><span class="o">::</span><span class="n">single</span><span class="o">&gt;::</span><span class="n">definition</span><span class="o">&lt;</span><span class="n">topo</span><span class="o">::</span><span class="n">index</span><span class="o">&gt;</span> <span class="n">fields</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Both of these methods of registering fields are valid, and it is left up
to the user to decide which way makes the most sense. The performance
implications of choosing one method over the other are equivalent to
choosing <em>array-of-struct (AoS)</em> or <em>struct-of-array (SoA)</em>. FleCSI does
not currently support switching or auto-tuning of the data layout.
However, we may do so in future versions.</p>
<div class="sidebar">
<p class="sidebar-title">Memory Allocation</p>
<p>You may be wondering whether or not field registration in FleCSI
implies that every instance of a topology type will necessarily create
an instance of every registered field. This is a valid concern! The
answer is <em>no!</em> FleCSI will only allocate memory for a field instance
if it is actually accessed.</p>
</div>
</div>
<div class="section" id="colorings">
<h2>Colorings<a class="headerlink" href="#colorings" title="Permalink to this headline">¶</a></h2>
<p>Let’s continue discussing the index topology so that we can add some
more details about its index space and define what <em>coloring</em> means in
FleCSI.</p>
<p>As stated above, the index topology has a single implicit index space.
For the index topology, we can think of the implicit index space as just
being the indices, with a particular instance being defined by its size.</p>
<p>The index topology also has an implicit coloring that
assigns each index of the topology’s indices to its own color: i.e.,
index 0 is assigned to color 0, etc. This simple example illustrates the
definition of a coloring:</p>
<div class="admonition-definition admonition">
<p class="admonition-title">Definition</p>
<p>A coloring is a description of how the indices of an index space
should be divided into partitions or colors.</p>
</div>
<p>The <em>size</em> of the default index topology instance is taken from the
number of processes with which the FleCSI runtime was launched. This is
a special case. In general, there is no implied size for a coloring, and
no association with the details of a particular execution space, i.e.,
the number of processes.  A coloring only describes how to divide the
indices of an index space into partitions (or colors in FleCSI’s
nomenclature).</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>A coloring is not associated with an execution space. This is
different from the way that many people think about MPI, where a rank
is statically mapped to a particular process.</p>
</div>
<p>Users are allowed to add addtional named instances of the global or index topologies:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">flecsi</span><span class="p">;</span>

<span class="n">topo</span><span class="o">::</span><span class="n">global</span><span class="o">::</span><span class="n">slot</span> <span class="n">pair</span><span class="p">;</span>
<span class="n">topo</span><span class="o">::</span><span class="n">index</span><span class="o">::</span><span class="n">slot</span> <span class="n">hydro_indices</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">initialize</span><span class="p">()</span> <span class="p">{</span>  <span class="c1">// called from the top-level action</span>
  <span class="n">pair</span><span class="p">.</span><span class="n">allocate</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="n">hydro_indices</span><span class="p">.</span><span class="n">allocate</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note the different interpretations of the sizes: <code class="docutils literal notranslate"><span class="pre">pair</span></code> doesn’t have colors and holds 2 field values, while <code class="docutils literal notranslate"><span class="pre">hydro_indices</span></code> has 42 colors with one field value each.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="runtime.html" class="btn btn-neutral float-right" title="Runtime Model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cmake.html" class="btn btn-neutral float-left" title="CMake for FleCSI client applications" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Copyright (C) 2016, Triad National Security, LLC

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    

  <style>
    /* Contents caption */
    .wy-menu-vertical>p.caption {
      color: #ffffff;
    }

    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #e3e2db;
    }
    .wy-side-nav-search>div.version, .wy-nav-top>div.version {
      color: #5f5d5f;
    }

    /* Sidebar */
    .wy-nav-side {
      background: #216897;
      color: #ffffff;
    }
  </style>


</body>
</html>