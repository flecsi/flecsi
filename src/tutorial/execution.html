

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Execution Model &mdash; FleCSI 2.1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  
    <link rel="canonical" href="http://www.flecsi.org/src/tutorial/execution.html"/>
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Data Model" href="data.html" />
    <link rel="prev" title="Control Model" href="control.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/flecsi.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                Version: 2.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build.html">Build &amp; Install</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorial.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../tutorial.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial.html#building-the-examples">Building the Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial.html#using-the-docker-container">Using the Docker Container</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../tutorial.html#tutorial-examples">Tutorial Examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="runtime.html">Runtime Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="control.html">Control Model</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Execution Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tasks">Tasks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example-1-single-tasks">Example 1: Single Tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-2-index-tasks">Example 2: Index Tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-3-mpi-tasks">Example 3: MPI Tasks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="data.html">Data Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="parallel.html">Distributed and shared memory parallelism</a></li>
<li class="toctree-l3"><a class="reference internal" href="topologies.html">Topologies</a></li>
<li class="toctree-l3"><a class="reference internal" href="standalone.html">Standalone</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developer-guide.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../specialization-guide.html">Specialization Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../summary.html">Internal Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../team.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../team.html#alumni">Alumni</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">FleCSI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../tutorial.html">Tutorial</a> &raquo;</li>
        
      <li>Execution Model</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/src/tutorial/execution.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="execution-model">
<span id="tut-cm"></span><h1>Execution Model<a class="headerlink" href="#execution-model" title="Permalink to this headline">¶</a></h1>
<p>FleCSI has two mechanisms for expressing work:</p>
<ul class="simple">
<li><p><strong>Tasks</strong> <br />
Tasks operate on data distributed to one or more address spaces, and
use data privileges to maintain memory consistency. FleCSI tasks are
like a more flexible version of MPI that does not require the user to
explicitly update dependencies between different ranks, and which does
not use static process mappings, i.e., relocatable, distributed-memory
data parallelism.</p></li>
<li><p><strong>Kernels</strong> <br />
Kernels operate on data in a single address space, but require
explicit barriers to ensure consistency. This is generally referred to
as a relaxed-consistency memory model. The kernel interface in
FleCSI is defined by three parallel operations: <em>forall</em>, <em>reduceall</em>,
and <em>scan</em>. Each of these is a fine-grained, data-parallel operation.
The use of the <em>kernel</em> nomenclature is derived from CUDA, and OpenCL,
and is conceptually consistent with those models. Please see example
of using <em>forall</em> kernels in <em>parallel</em> section of the tutorials.</p></li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="tasks">
<h1>Tasks<a class="headerlink" href="#tasks" title="Permalink to this headline">¶</a></h1>
<div class="section" id="example-1-single-tasks">
<h2>Example 1: Single Tasks<a class="headerlink" href="#example-1-single-tasks" title="Permalink to this headline">¶</a></h2>
<p>Single task is a task that operates on entire data passed to it and is
executed by a single process.
<cite>execute</cite> method will call a single task if no ‘launch domain` (see in
the next example) or a topology with a launch domain is passed to it.</p>
<p>In the example of <cite>trivial</cite> task, there is no arguments passed and a
default <cite>launch domain</cite> is used. Therefore, it is a single task</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>  <span class="n">flog</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Hello World&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>  <span class="cm">/*</span>
</pre></div>
</div>
<p>You can return a value from the task. And A <cite>future</cite> is a mechanism, to
access the result of an asynchronous task execution.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>    <span class="cm">/*</span>
<span class="cm">      The &#39;wait()&#39; method waits for the result to become available.</span>
<span class="cm">     */</span>

    <span class="n">future</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span>

    <span class="cm">/*</span>
<span class="cm">      The &#39;get()&#39; method returns the result. Note that calling &#39;get()&#39; by itself</span>
<span class="cm">      will wait for the result to become available. The call to &#39;wait()&#39; in this</span>
<span class="cm">      example are illustrative.</span>
<span class="cm">     */</span>

    <span class="n">flog</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Got value &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">future</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span> <span class="c1">// scope</span>
</pre></div>
</div>
<p>FleCSI can execute a task that takes an argument by-value.
FleCSI tasks can take any valid C++ type by value. However, because task
data must be relocatable, you cannot pass pointer arguments, or
arguments that contain pointers.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>    <span class="n">flog</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Sum is &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">future</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span> <span class="c1">// scope</span>
</pre></div>
</div>
<p>FleCSI tasks can also be templated:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">templated_task</span><span class="p">(</span><span class="n">Type</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Type</span> <span class="n">retval</span><span class="p">{</span><span class="n">t</span> <span class="o">+</span> <span class="n">Type</span><span class="p">(</span><span class="mi">10</span><span class="p">)};</span>
  <span class="n">flog</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Returning value &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">retval</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; with type &quot;</span>
             <span class="o">&lt;&lt;</span> <span class="k">typeid</span><span class="p">(</span><span class="n">t</span><span class="p">).</span><span class="n">name</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">retval</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>    <span class="n">flog</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Got templated value &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">future</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span> <span class="c1">// scope</span>
</pre></div>
</div>
</div>
<div class="section" id="example-2-index-tasks">
<h2>Example 2: Index Tasks<a class="headerlink" href="#example-2-index-tasks" title="Permalink to this headline">¶</a></h2>
<p>Index task is a task that is executed by several processes. It is often
used to operate on different parts of the input data (like partitioned
mesh) asynchronously.</p>
<p>In this example we explicitly ask to execute <cite>task</cite> on 4 processes by
specifying <cite>launch_domain</cite> parameter</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">task</span><span class="p">(</span><span class="n">exec</span><span class="o">::</span><span class="n">launch_domain</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">flog</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Hello World from color &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">color</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; of &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">colors</span><span class="p">()</span>
             <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  Advance control point.</span>
<span class="cm"> */</span>

<span class="kt">int</span>
<span class="nf">advance</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">exec</span><span class="o">::</span><span class="n">launch_domain</span> <span class="n">ld</span><span class="p">{</span><span class="mi">4</span><span class="p">};</span>

  <span class="n">execute</span><span class="o">&lt;</span><span class="n">task</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ld</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="launch-domains">
<h3>Launch Domains<a class="headerlink" href="#launch-domains" title="Permalink to this headline">¶</a></h3>
<p>Launch domain (<cite>exec::launch_domain</cite>) is used to define how many index
points should index task have. If no <cite>launch_dmain</cite> is passed to the
<cite>execute</cite> method, the default will be used. The default is <cite>0</cite> if no
topology instanced is passed or the one specified in the topology
instance passed to the task (the number of colors topology instance
have).</p>
</div>
</div>
<div class="section" id="example-3-mpi-tasks">
<h2>Example 3: MPI Tasks<a class="headerlink" href="#example-3-mpi-tasks" title="Permalink to this headline">¶</a></h2>
<p>MPI task is an index task that has launch domain size equal to number of
MPI ranks and index points mapped to corresponding MPI ranks. Executing
MPI task adds synchronization between Legion and MPI and, therefore,
should only be used when one needs to call MPI library.
To execute an MPI task, second template parameter to the <cite>execute</cite>
method should be set to <cite>mpi</cite>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">task</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">flog</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Hello World from process: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">process</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  Advance control point.</span>
<span class="cm"> */</span>

<span class="kt">int</span>
<span class="nf">advance</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">execute</span><span class="o">&lt;</span><span class="n">task</span><span class="p">,</span> <span class="n">mpi</span><span class="o">&gt;</span><span class="p">();</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="data.html" class="btn btn-neutral float-right" title="Data Model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="control.html" class="btn btn-neutral float-left" title="Control Model" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Copyright (c) 2016, Triad National Security, LLC

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    

  <style>
    /* Contents caption */
    .wy-menu-vertical>p.caption {
      color: #ffffff;
    }

    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #e3e2db;
    }
    .wy-side-nav-search>div.version, .wy-nav-top>div.version {
      color: #5f5d5f;
    }

    /* Sidebar */
    .wy-nav-side {
      background: #216897;
      color: #ffffff;
    }
  </style>


</body>
</html>